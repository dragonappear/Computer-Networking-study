# 라우터



input port는 라우터가 서로 다른 라우터 또는 컴퓨터나 스위치와 연결될 수 있는 물리적인 장비이다.  입력포트는 검색기능을 활용하여 라우팅 테이블을 확인하고 이에 따라서 출력 포트를 검색할 수 있다. 라우터는 패킷의 TTL을 1씩 감소시켜서 네트워크상에 순환적으로 패킷이 떠도는 현상을 방지할 수 있다. TTL이 0인 패킷은 버려버린다.



라우팅 테이블은 프리픽스와 링크 인터페이의 1:1 매칭으로 이루어져 있다. 목적지 주소의 프리픽스를 활용하여 일치하는 가장 긴 프리픽스에 해당하는 링크 인터페이스로 패킷을 포워딩한다.



출력포트는 출력 포트 메모리에 저장된 패킷을 출력 링크를 통해 전송한다. 출력 포트 메모리에는 한계가 있기 때문에 큐에 쌓여있는 데이터가 메모리 한계를 넘어서는 순간부터 패킷은 버려지게 된다.



큐는 입력포트와 출력포트 둘다 존재한다. 스위치 구조는 한번에 하나의 패킷만 지정된 출력포트로 전송이 가능하기 때문에 같은 출력포트로 전송될 두개의 패킷은 하나씩 순차적으로 처리되야 하고 대기하는 패킷은 큐에서 기다리게 된다. 만약 서로다른 출력포트로 향하는 여러개의 패킷은 병렬로 처리될 수 있다.

 

패킷이 손실되는 것을 방지하기 위해 버퍼의 크기는 크면 클수록 좋다고 생각하기 쉬우나 이는 잘못된 생각이다. 버퍼의 크기가 커질수록 패킷이 큐에서 대기하는 시간이 길어지고 이는 지연율이 증가하는 현상으로 나타나게 된다.



# NAT network

IPv4 ip address의 고갈이 점점 다가와서 생겨나게 되었다. 하나의 공인 ip 주소를 가지고 여러개의 디바이스를 사용할 수 있게 하는 기술이다. 각각의 디바이스들은 프라이빗 Ip 주소를 할당받는다. 이는 글로벌하게 유니크하지도 않고 인터넷상에서도 사용될 수 없는 IP이다. 

NAT 라우터는 NAT 변환 테이블을 사용하고 IP와 포트번호를 내부에서 사용하는 것과 외부용을 1:1로 맵핑시켜서 사용한다.



# IPv4

전 세계 인터넷에서 모든 호스트와 라우터의 각 인터페이스들은 고유한 IP를 갖는다. 32비트로 주소를 표현할 수 있다.

IP주소의 일부는 서브넷이 결정한다. CIDR이 등장하기 전에는 네트워크 비트를 몇비트로 쓰냐에 따라 A,B,C클래스로 나누었다.

하지만 이러한 방식에는 여러가지 부작용이 존재했다. 클래스별로 어떤건 너무 네트워크 비트가 적어서 호스트 네트웤이 많이 생기는 반면 어떤건 네트워크 비트가 너무 많아서 호스트를 조금밖에 할당할 수 없었다.

이러한 고정적인 부분을 유연하게 바꾸기 위해서 CIDR표기법이 등장하였다. a.b.c.d/x 로 표기하여 x는 네트워크 부분이 어디까지인지를 나타낸다. 

브로드캐스트는 255.255.255.255 주소를 사용하며 동일 서브넷에 있는 모든 호스트들에게 데이터를 전송한다. 브로드캐스트는 DHCP를 통해서 동적으로 IP를 할당받을때 사용될 수 있다.



# subnetting

서브넷팅은 큰 네트워크를 서브넷이라는 작은 네트워크들로 쪼개는 것이다. 

작은 네트워크로 쪼개는 것은 관리를 용이하게 해주고 다른 네트워크와 고립시킴에 따라 보안성을 향상시킬 수 있다. 또한 브로드 캐스트 도메인의 사이즈를 줄임으로써 퍼포먼스 향상도 기대할 수 있다.



# Loopback address

디바이스 상에서 같은 네트워크를 가르키는 ip address이다. 보통 네트워크 테스트나 진단에 사용된다. 가장 많이 사용되는 address 는 127.0.0.1이다. IPv4에서 사용되는 Loopback address 이다. 웹서버나 이메일 서버와같은 네트워크 서비스를 테스트할때 주로 사용된다. 또한 네트워크에 어더한 문제가 있는지 진단할때 사용된다. 네트워크 스택으로 부터 적절한 응답이 오는지를 확인할 수 있다. 네트워크 트래픽을 발생시켜 부하테스트를 하는데에도 사용될 수 있다.



# 질문거리

네트워크 레이어의 목적은 무엇일까요?

왜 트랜스포트 레이어에 checksum이 있는데 네트웤 레이어에도 체크섬이 있는가?

NAT 네트워크를 사용했을때의 사이드 이펙트는 없는가?

왜 라우팅 알고리즘은 모든 라우터에서 실행되어야 하는가?

라우터에서의 라우팅과 포워딩의 차이를 설명해주세요.

loopback address는 무엇인가? 또 어떻게 쓰일 수 있는가

default gateway는 무슨 역할을 하는가?

만약 라우팅 테이블에 다음 목적지에 대한 맵핑정보가 없다면 라우터는 어떻게 동작하는가?